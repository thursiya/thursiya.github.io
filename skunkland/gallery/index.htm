<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Skunkland Server</title>
		<link rel="stylesheet" href="../data/mc.css">
		<link rel="icon" href="../images/pickaxe.png" type="image/x-icon">
		<script src="../data/time.js"></script>
		<script src="../data/header.js"></script>
	</head>
	<body>
		<header><script>insertHeader();</script></header>
		<main>
			<div class="content round shadow">
				<div id="gallerycontainer"></div>
				<div class="contentheader round">Galleries</div>
				<div class="row" id="general"></div>
				<hr style="border: 1px solid #999; width: 70%; margin: auto">
				<div class="row" id="states"></div>
			</div>
		</main>
		<script>
			const g = [];
			loadDoc("https://api.github.com/repos/thursiya/thursiya.github.io/contents/skunkland/gallery/images", getRandomImages);	

			function getRandomImages(xhr) {
				let pics = JSON.parse(xhr.response);
				for (let i = pics.length - 1; i > 0; i--) {
					let r = ~~(Math.random() * (i + 1));
					[pics[i], pics[r]] = [pics[r], pics[i]];
				}
				pics.splice(-3);
				g.push({name: "Random Screenshots", type: -1, section: [{img: [pics[0].name.slice(0, -4), pics[1].name.slice(0, -4), pics[2].name.slice(0, -4)]}]});
				loadDoc("../data/gallery.txt", buildGalleryArray);
			}

			function buildGalleryArray(xhr) {
				g.push(...JSON.parse(xhr.response.replace(/(\s*{\s*|\s*,\s*)(['"])?(\w+)(['"])?:/g, '$1"$3":')));
				function writeLinks(arr, dest) {
					let out = "";
					for (let i = 0; i < arr.length; i++) {
						if (i == 0 || i == Math.ceil(arr.length / 2)) out += `<div class="col-6"><ul>`;
						out += `<li><span style="font-weight: bold; color: #00F; cursor: pointer" onclick="loadGallery(${g.findIndex(v => v.name == arr[i].name)})">${arr[i].name}</span>`;
						if (i == arr.length - 1 || i == Math.ceil(arr.length / 2) - 1) out += `</ul></div>`;
					}
					document.getElementById(dest).innerHTML = out;
				}
				loadGallery(0);
				writeLinks(g.filter(v => v.type == 0), "general");
				writeLinks(g.filter(v => v.type == 1), "states");
			}

			function loadGallery(v) {
				let out = "";
				for (let i = 0; i < g[v].section.length; i++) {
					out += `<div class="contentheader round">${g[v].section[i].title || g[v].name}</div><div class="gallery">`;
					g[v].section[i].img.forEach(j => out += `<div><a href="images/${j}.jpg" target="_blank"><img src="images/${j}.jpg" height="175" alt="${j}"><div class="caption">${j}</div></a></div>`);
					out += `</div>`;
				}
				document.getElementById("gallerycontainer").innerHTML = out;
			}
		</script>
	</body>
</html>
