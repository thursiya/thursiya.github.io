<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Skunkland Server</title>
		<link rel="stylesheet" href="../data/mc.css">
		<link rel="icon" href="../images/pickaxe.png" type="image/x-icon">
		<script src="../data/time.js"></script>
		<script src="../data/header.js"></script>
	</head>
	<body>
		<header><script>insertHeader();</script></header>
		<main>
			<div class="content round shadow">
				<div id="gallery"></div>
				<div class="contentheader round">Galleries</div>
				<div class="row" id="general"></div>
				<hr style="border: 1px solid #999; width: 70%; margin: auto">
				<div class="row" id="states"></div>
			</div>
		</main>
		<script>
			let g = [];
			loadDoc("https://api.github.com/repos/thursiya/thursiya.github.io/contents/skunkland/gallery/images", getRandomImages);
			loadDoc("../data/gallery.txt", buildGalleryArray);
			loadGallery(0);
			
			function loadDoc(url, cFunction) {
  				const xhttp = new XMLHttpRequest();
  				xhttp.onload = function() {cFunction(this);}
  				xhttp.open("GET", url);
  				xhttp.send();
			}

			function getRandomImages(xhr) {
				let pics = JSON.parse(xhr.response);
				for (let i = pics.length - 1; i > 0; i--) {
					let r = ~~(Math.random() * (i + 1));
					[pics[i], pics[r]] = [pics[r], pics[i]];
				}
				pics.splice(-3);
				g.push({name: "Random Screenshots", type: -1, section: [{img: [pics[0].name.slice(0, -4), pics[1].name.slice(0, -4), pics[2].name.slice(0, -4)]}]});
				console.log(g);
				//let out = `<div class="contentheader round">Random Screenshots</div><div class="row">`;
				//for (let p of pics.splice(-3)) out += `<div class="col-4"><a href="${p.download_url}" target="_blank"><img src="${p.download_url}" height="175" alt="${p.name.slice(0,-4)}"></a></div>`;
				//document.getElementById('gallery').innerHTML = `${out}</div><br><br>`;
			}

			function buildGalleryArray(xhr) {
				g.push(...JSON.parse(xhr.response.replace(/(\s*{\s*|\s*,\s*)(['"])?(\w+)(['"])?:/g, '$1"$3":')));
				console.log(g);
				let states = g.filter(v => v.type == 1);
				let general = g.filter(v => v.type == 0);
				let gcount = 0;
				function writeLinks(arr,dest) {
					let out = "";
					for (let i = 0; i < arr.length; i++) {
						if (i == 0 || i == Math.ceil(arr.length / 2)) out += `<div class="col-6"><ul>`;
						out += `<li><span style="font-weight: bold; color: #00F" onclick="loadGallery(${gcount})">${arr[i].name}</span>`;
						if (i == arr.length - 1 || i == Math.ceil(arr.length / 2) - 1) out += `</ul></div>`;
						gcount++;
					}
					document.getElementById(dest).innerHTML = out;
				}
				writeLinks(general, "general");
				writeLinks(states, "states");
			}

			function loadGallery(v) {
				let out = "";
				for (let i = 0; i < g[v].section.length; i++) {
					out += `<div class="contentheader round">${g[v].section[i].title || g[v].name}</div><div class="row">`;
					for (let j = 0; j < g[v].section[i].img.length; j++) {
						let pic = g[v].section[i].img[j];
						out += `<div class="col-4"><a href="images/${pic}.jpg" target="_blank"><img src="images/${pic}.jpg" height="175" alt="${pic}"><br><br>${pic}</a></div>`;
					}
					out += `</div><br><br>`;
				}
				document.getElementById("gallery").innerHTML = out;
			}
		</script>
	</body>
</html>
